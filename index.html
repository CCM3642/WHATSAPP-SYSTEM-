<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment & Delivery Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 1.5rem;
        }

        .icon-primary {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .icon-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .icon-warning {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }

        .icon-danger {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.95rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        th {
            background-color: var(--light);
            font-weight: 600;
            color: var(--dark);
        }

        tr:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        .progress-bar {
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress {
            height: 100%;
            border-radius: 4px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .upload-area {
            border: 2px dashed var(--primary);
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background-color: rgba(67, 97, 238, 0.05);
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-area:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .upload-area p {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .upload-area small {
            color: var(--gray);
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn:hover {
            background-color: var(--secondary);
        }

        .filter-container {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: inherit;
            transition: var(--transition);
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--success);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background-color: var(--danger);
        }

        .footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            color: var(--gray);
            border-top: 1px solid var(--light-gray);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .filter-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Payment & Delivery Analytics Dashboard</h1>
            <p>Comprehensive analysis of payment methods and delivery performance</p>
        </header>

        <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Drag & drop your Excel file here or click to browse</p>
            <small>Supported formats: .xlsx, .xls</small>
            <input type="file" id="fileInput" accept=".xlsx, .xls" style="display: none;">
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Processing your data...</p>
        </div>

        <div class="filter-container" id="filterContainer" style="display: none;">
            <div class="filter-group">
                <label for="monthFilter">Month</label>
                <select id="monthFilter">
                    <option value="all">All Months</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="branchFilter">Branch</label>
                <select id="branchFilter">
                    <option value="all">All Branches</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="yearFilter">Year</label>
                <select id="yearFilter">
                    <option value="all">All Years</option>
                    <option value="2025">2025</option>
                </select>
            </div>
        </div>

        <div id="dashboardContent" style="display: none;">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Total Sales</h3>
                        <div class="card-icon icon-primary">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalSales">AED 0</div>
                    <div class="stat-label">Overall Revenue</div>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%; background-color: var(--primary);" id="salesProgress"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Total Transactions</h3>
                        <div class="card-icon icon-success">
                            <i class="fas fa-receipt"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalTransactions">0</div>
                    <div class="stat-label">All Payment Methods</div>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%; background-color: var(--success);" id="transactionsProgress"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Delivery Sales</h3>
                        <div class="card-icon icon-warning">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="deliverySales">AED 0</div>
                    <div class="stat-label">All Delivery Platforms</div>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%; background-color: var(--warning);" id="deliveryProgress"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Card Payments</h3>
                        <div class="card-icon icon-danger">
                            <i class="fas fa-credit-card"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="cardPercentage">0%</div>
                    <div class="stat-label">Percentage of Total Sales</div>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%; background-color: var(--danger);" id="cardProgress"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Payment Method Comparison</h3>
                    <div class="tabs">
                        <div class="tab active" data-tab="visa-master">Visa vs Mastercard</div>
                        <div class="tab" data-tab="cash-card">Cash vs Card</div>
                        <div class="tab" data-tab="platforms">Platform Performance</div>
                    </div>
                </div>
                
                <div class="tab-content active" id="visa-master">
                    <div class="chart-container">
                        <canvas id="visaMasterChart"></canvas>
                    </div>
                    <div class="table-container">
                        <table id="visaMasterTable">
                            <thead>
                                <tr>
                                    <th>Payment Method</th>
                                    <th>Total Amount</th>
                                    <th>Transaction Count</th>
                                    <th>Average Transaction</th>
                                    <th>Market Share</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Visa Card</td>
                                    <td id="visaAmount">AED 0</td>
                                    <td id="visaCount">0</td>
                                    <td id="visaAvg">AED 0</td>
                                    <td id="visaShare">0%</td>
                                </tr>
                                <tr>
                                    <td>Mastercard</td>
                                    <td id="masterAmount">AED 0</td>
                                    <td id="masterCount">0</td>
                                    <td id="masterAvg">AED 0</td>
                                    <td id="masterShare">0%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="cash-card">
                    <div class="chart-container">
                        <canvas id="cashCardChart"></canvas>
                    </div>
                    <div class="table-container">
                        <table id="cashCardTable">
                            <thead>
                                <tr>
                                    <th>Payment Type</th>
                                    <th>Total Amount</th>
                                    <th>Transaction Count</th>
                                    <th>Average Transaction</th>
                                    <th>Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Cash</td>
                                    <td id="cashAmount">AED 0</td>
                                    <td id="cashCount">0</td>
                                    <td id="cashAvg">AED 0</td>
                                    <td id="cashPercentage">0%</td>
                                </tr>
                                <tr>
                                    <td>Card</td>
                                    <td id="cardAmount">AED 0</td>
                                    <td id="cardCount">0</td>
                                    <td id="cardAvg">AED 0</td>
                                    <td id="cardPercentage2">0%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="platforms">
                    <div class="chart-container">
                        <canvas id="platformChart"></canvas>
                    </div>
                    <div class="table-container">
                        <table id="platformTable">
                            <thead>
                                <tr>
                                    <th>Platform</th>
                                    <th>Total Amount</th>
                                    <th>Transaction Count</th>
                                    <th>Average Transaction</th>
                                    <th>Market Share</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Talabat</td>
                                    <td id="talabatAmount">AED 0</td>
                                    <td id="talabatCount">0</td>
                                    <td id="talabatAvg">AED 0</td>
                                    <td id="talabatShare">0%</td>
                                </tr>
                                <tr>
                                    <td>Noon</td>
                                    <td id="noonAmount">AED 0</td>
                                    <td id="noonCount">0</td>
                                    <td id="noonAvg">AED 0</td>
                                    <td id="noonShare">0%</td>
                                </tr>
                                <tr>
                                    <td>Careem</td>
                                    <td id="careemAmount">AED 0</td>
                                    <td id="careemCount">0</td>
                                    <td id="careemAvg">AED 0</td>
                                    <td id="careemShare">0%</td>
                                </tr>
                                <tr>
                                    <td>Smile</td>
                                    <td id="smileAmount">AED 0</td>
                                    <td id="smileCount">0</td>
                                    <td id="smileAvg">AED 0</td>
                                    <td id="smileShare">0%</td>
                                </tr>
                                <tr>
                                    <td>Deliveroo</td>
                                    <td id="deliverooAmount">AED 0</td>
                                    <td id="deliverooCount">0</td>
                                    <td id="deliverooAvg">AED 0</td>
                                    <td id="deliverooShare">0%</td>
                                </tr>
                                <tr>
                                    <td>Keeta</td>
                                    <td id="keetaAmount">AED 0</td>
                                    <td id="keetaCount">0</td>
                                    <td id="keetaAvg">AED 0</td>
                                    <td id="keetaShare">0%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Restaurant Delivery Performance</h3>
                    <div class="tabs">
                        <div class="tab active" data-tab="delivery-comparison">Delivery Comparison</div>
                        <div class="tab" data-tab="delivery-levels">Delivery Levels</div>
                        <div class="tab" data-tab="monthly-report">Monthly Report</div>
                    </div>
                </div>
                
                <div class="tab-content active" id="delivery-comparison">
                    <div class="chart-container">
                        <canvas id="restaurantChart"></canvas>
                    </div>
                    <div class="table-container">
                        <table id="restaurantTable">
                            <thead>
                                <tr>
                                    <th>Branch</th>
                                    <th>Internal Delivery</th>
                                    <th>Third-Party Delivery</th>
                                    <th>Total Delivery</th>
                                    <th>Delivery % of Sales</th>
                                </tr>
                            </thead>
                            <tbody id="restaurantTableBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="delivery-levels">
                    <div class="chart-container">
                        <canvas id="deliveryLevelsChart"></canvas>
                    </div>
                    <div class="table-container">
                        <table id="deliveryLevelsTable">
                            <thead>
                                <tr>
                                    <th>Delivery Type</th>
                                    <th>Total Amount</th>
                                    <th>Transaction Count</th>
                                    <th>Average Transaction</th>
                                    <th>Percentage of Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Internal Delivery</td>
                                    <td id="internalAmount">AED 0</td>
                                    <td id="internalCount">0</td>
                                    <td id="internalAvg">AED 0</td>
                                    <td id="internalPercentage">0%</td>
                                </tr>
                                <tr>
                                    <td>Third-Party Delivery</td>
                                    <td id="thirdPartyAmount">AED 0</td>
                                    <td id="thirdPartyCount">0</td>
                                    <td id="thirdPartyAvg">AED 0</td>
                                    <td id="thirdPartyPercentage">0%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="monthly-report">
                    <div class="chart-container">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                    <div class="table-container">
                        <table id="monthlyTable">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Total Sales</th>
                                    <th>Internal Delivery</th>
                                    <th>Third-Party Delivery</th>
                                    <th>Cash %</th>
                                    <th>Card %</th>
                                    <th>Growth</th>
                                </tr>
                            </thead>
                            <tbody id="monthlyTableBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>© 2023 Payment & Delivery Analytics Dashboard. All rights reserved.</p>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Global variables
        let salesData = [];
        let filteredData = [];
        let charts = {};

        // DOM elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const monthFilter = document.getElementById('monthFilter');
        const branchFilter = document.getElementById('branchFilter');
        const yearFilter = document.getElementById('yearFilter');
        const notification = document.getElementById('notification');
        const loading = document.getElementById('loading');
        const filterContainer = document.getElementById('filterContainer');
        const dashboardContent = document.getElementById('dashboardContent');

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            // Set up event listeners
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            fileInput.addEventListener('change', handleFileSelect);
            
            monthFilter.addEventListener('change', applyFilters);
            branchFilter.addEventListener('change', applyFilters);
            yearFilter.addEventListener('change', applyFilters);
            
            // Set up tab navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    const tabContents = document.querySelectorAll('.tab-content');
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabName) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // Load sample data for demonstration
            loadSampleData();
        });

        // File handling functions
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.style.backgroundColor = 'rgba(67, 97, 238, 0.2)';
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.style.backgroundColor = 'rgba(67, 97, 238, 0.05)';
            
            if (e.dataTransfer.files.length) {
                processFile(e.dataTransfer.files[0]);
            }
        }

        function handleFileSelect(e) {
            if (e.target.files.length) {
                processFile(e.target.files[0]);
            }
        }

        function processFile(file) {
            loading.classList.add('show');
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get the first sheet
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Convert to JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // Process the data
                    processData(jsonData);
                    
                    showNotification('File uploaded successfully!', 'success');
                } catch (error) {
                    showNotification('Error processing file. Please check the format.', 'error');
                    console.error(error);
                } finally {
                    loading.classList.remove('show');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function processData(data) {
            // Clear existing data
            salesData = [];
            
            // Skip header row
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                
                // Skip empty rows or rows with asterisks
                if (!row || row.length === 0 || row[0] === '*' || row[0] === 'HEAD') {
                    continue;
                }
                
                // Extract data
                const record = {
                    branch: row[1],
                    month: parseInt(row[2]),
                    year: parseInt(row[3]),
                    receipts: parseFloat(row[4]) || 0,
                    talabat: parseFloat(row[5]) || 0,
                    tabna: parseFloat(row[6]) || 0,
                    keeta: parseFloat(row[7]) || 0,
                    cash: parseFloat(row[8]) || 0,
                    noon: parseFloat(row[9]) || 0,
                    mastercard: parseFloat(row[10]) || 0,
                    visa: parseFloat(row[11]) || 0,
                    careem: parseFloat(row[12]) || 0,
                    deliveryCard: parseFloat(row[13]) || 0,
                    smiles: parseFloat(row[14]) || 0,
                    deliveryCash: parseFloat(row[15]) || 0,
                    deliveroo: parseFloat(row[16]) || 0,
                    onlineCash: parseFloat(row[17]) || 0,
                    onlineCard: parseFloat(row[18]) || 0,
                    countReceipts: parseInt(row[19]) || 0,
                    countTalabat: parseInt(row[20]) || 0,
                    countTabna: parseInt(row[21]) || 0,
                    countKeeta: parseInt(row[22]) || 0,
                    countCash: parseInt(row[23]) || 0,
                    countNoon: parseInt(row[24]) || 0,
                    countMaster: parseInt(row[25]) || 0,
                    countVisa: parseInt(row[26]) || 0,
                    countCareem: parseInt(row[27]) || 0,
                    countDeliveryCard: parseInt(row[28]) || 0,
                    countSmiles: parseInt(row[29]) || 0,
                    countDeliveryCash: parseInt(row[30]) || 0,
                    countDeliveroo: parseInt(row[31]) || 0,
                    countOnlineCash: parseInt(row[32]) || 0,
                    countOnlineCard: parseInt(row[33]) || 0
                };
                
                salesData.push(record);
            }
            
            // Update branch filter
            updateBranchFilter();
            
            // Apply filters and update dashboard
            applyFilters();
            
            // Show dashboard content
            filterContainer.style.display = 'flex';
            dashboardContent.style.display = 'block';
        }

        function updateBranchFilter() {
            const branches = [...new Set(salesData.map(item => item.branch))];
            
            branchFilter.innerHTML = '<option value="all">All Branches</option>';
            
            branches.forEach(branch => {
                const option = document.createElement('option');
                option.value = branch;
                option.textContent = branch;
                branchFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const monthValue = monthFilter.value;
            const branchValue = branchFilter.value;
            const yearValue = yearFilter.value;
            
            filteredData = salesData.filter(item => {
                return (monthValue === 'all' || item.month === parseInt(monthValue)) &&
                       (branchValue === 'all' || item.branch === branchValue) &&
                       (yearValue === 'all' || item.year === parseInt(yearValue));
            });
            
            updateDashboard();
        }

        function updateDashboard() {
            // Calculate summary metrics
            const totalSales = filteredData.reduce((sum, item) => sum + item.receipts, 0);
            const totalTransactions = filteredData.reduce((sum, item) => sum + item.countReceipts, 0);
            
            // Calculate delivery sales
            const deliverySales = filteredData.reduce((sum, item) => {
                return sum + item.talabat + item.keeta + item.noon + item.careem + 
                       item.smiles + item.deliveroo + item.deliveryCard + item.deliveryCash;
            }, 0);
            
            // Calculate card payments
            const cardPayments = filteredData.reduce((sum, item) => {
                return sum + item.mastercard + item.visa + item.noon + item.careem + 
                       item.smiles + item.deliveroo + item.deliveryCard + item.onlineCard;
            }, 0);
            
            const totalPayments = filteredData.reduce((sum, item) => {
                return sum + item.cash + item.deliveryCash + item.onlineCash + cardPayments;
            }, 0);
            
            const cardPercentage = totalPayments > 0 ? (cardPayments / totalPayments * 100).toFixed(1) : 0;
            
            // Update summary cards
            document.getElementById('totalSales').textContent = `AED ${totalSales.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalTransactions').textContent = totalTransactions.toLocaleString();
            document.getElementById('deliverySales').textContent = `AED ${deliverySales.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('cardPercentage').textContent = `${cardPercentage}%`;
            
            // Update progress bars
            document.getElementById('salesProgress').style.width = '100%';
            document.getElementById('transactionsProgress').style.width = '100%';
            document.getElementById('deliveryProgress').style.width = totalSales > 0 ? `${(deliverySales / totalSales * 100).toFixed(1)}%` : '0%';
            document.getElementById('cardProgress').style.width = `${cardPercentage}%`;
            
            // Update payment method comparison
            updatePaymentComparison();
            
            // Update restaurant delivery performance
            updateRestaurantPerformance();
            
            // Update monthly report
            updateMonthlyReport();
        }

        function updatePaymentComparison() {
            // Calculate Visa vs Mastercard
            const visaAmount = filteredData.reduce((sum, item) => sum + item.visa, 0);
            const visaCount = filteredData.reduce((sum, item) => sum + item.countVisa, 0);
            const visaAvg = visaCount > 0 ? visaAmount / visaCount : 0;
            
            const masterAmount = filteredData.reduce((sum, item) => sum + item.mastercard, 0);
            const masterCount = filteredData.reduce((sum, item) => sum + item.countMaster, 0);
            const masterAvg = masterCount > 0 ? masterAmount / masterCount : 0;
            
            const totalCardAmount = visaAmount + masterAmount;
            const visaShare = totalCardAmount > 0 ? (visaAmount / totalCardAmount * 100).toFixed(1) : 0;
            const masterShare = totalCardAmount > 0 ? (masterAmount / totalCardAmount * 100).toFixed(1) : 0;
            
            // Update table
            document.getElementById('visaAmount').textContent = `AED ${visaAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('visaCount').textContent = visaCount.toLocaleString();
            document.getElementById('visaAvg').textContent = `AED ${visaAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('visaShare').textContent = `${visaShare}%`;
            
            document.getElementById('masterAmount').textContent = `AED ${masterAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('masterCount').textContent = masterCount.toLocaleString();
            document.getElementById('masterAvg').textContent = `AED ${masterAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('masterShare').textContent = `${masterShare}%`;
            
            // Update chart
            if (charts.visaMaster) {
                charts.visaMaster.destroy();
            }
            
            const ctx = document.getElementById('visaMasterChart').getContext('2d');
            charts.visaMaster = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Visa', 'Mastercard'],
                    datasets: [{
                        label: 'Total Amount (AED)',
                        data: [visaAmount, masterAmount],
                        backgroundColor: ['rgba(75, 192, 192, 0.7)', 'rgba(54, 162, 235, 0.7)'],
                        borderColor: ['rgba(75, 192, 192, 1)', 'rgba(54, 162, 235, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'AED ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Calculate Cash vs Card
            const cashAmount = filteredData.reduce((sum, item) => sum + item.cash + item.deliveryCash + item.onlineCash, 0);
            const cashCount = filteredData.reduce((sum, item) => sum + item.countCash + item.countDeliveryCash + item.countOnlineCash, 0);
            const cashAvg = cashCount > 0 ? cashAmount / cashCount : 0;
            
            const cardAmount2 = filteredData.reduce((sum, item) => {
                return sum + item.mastercard + item.visa + item.noon + item.careem + 
                       item.smiles + item.deliveroo + item.deliveryCard + item.onlineCard;
            }, 0);
            const cardCount2 = filteredData.reduce((sum, item) => {
                return sum + item.countMaster + item.countVisa + item.countNoon + item.countCareem + 
                       item.countSmiles + item.countDeliveroo + item.countDeliveryCard + item.countOnlineCard;
            }, 0);
            const cardAvg2 = cardCount2 > 0 ? cardAmount2 / cardCount2 : 0;
            
            const totalAmount = cashAmount + cardAmount2;
            const cashPercentage = totalAmount > 0 ? (cashAmount / totalAmount * 100).toFixed(1) : 0;
            const cardPercentage2 = totalAmount > 0 ? (cardAmount2 / totalAmount * 100).toFixed(1) : 0;
            
            // Update table
            document.getElementById('cashAmount').textContent = `AED ${cashAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('cashCount').textContent = cashCount.toLocaleString();
            document.getElementById('cashAvg').textContent = `AED ${cashAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('cashPercentage').textContent = `${cashPercentage}%`;
            
            document.getElementById('cardAmount').textContent = `AED ${cardAmount2.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('cardCount').textContent = cardCount2.toLocaleString();
            document.getElementById('cardAvg').textContent = `AED ${cardAvg2.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('cardPercentage2').textContent = `${cardPercentage2}%`;
            
            // Update chart
            if (charts.cashCard) {
                charts.cashCard.destroy();
            }
            
            const ctx2 = document.getElementById('cashCardChart').getContext('2d');
            charts.cashCard = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Cash', 'Card'],
                    datasets: [{
                        data: [cashAmount, cardAmount2],
                        backgroundColor: ['rgba(255, 206, 86, 0.7)', 'rgba(54, 162, 235, 0.7)'],
                        borderColor: ['rgba(255, 206, 86, 1)', 'rgba(54, 162, 235, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Calculate Platform Performance
            const talabatAmount = filteredData.reduce((sum, item) => sum + item.talabat, 0);
            const talabatCount = filteredData.reduce((sum, item) => sum + item.countTalabat, 0);
            const talabatAvg = talabatCount > 0 ? talabatAmount / talabatCount : 0;
            
            const noonAmount = filteredData.reduce((sum, item) => sum + item.noon, 0);
            const noonCount = filteredData.reduce((sum, item) => sum + item.countNoon, 0);
            const noonAvg = noonCount > 0 ? noonAmount / noonCount : 0;
            
            const careemAmount = filteredData.reduce((sum, item) => sum + item.careem, 0);
            const careemCount = filteredData.reduce((sum, item) => sum + item.countCareem, 0);
            const careemAvg = careemCount > 0 ? careemAmount / careemCount : 0;
            
            const smileAmount = filteredData.reduce((sum, item) => sum + item.smiles, 0);
            const smileCount = filteredData.reduce((sum, item) => sum + item.countSmiles, 0);
            const smileAvg = smileCount > 0 ? smileAmount / smileCount : 0;
            
            const deliverooAmount = filteredData.reduce((sum, item) => sum + item.deliveroo, 0);
            const deliverooCount = filteredData.reduce((sum, item) => sum + item.countDeliveroo, 0);
            const deliverooAvg = deliverooCount > 0 ? deliverooAmount / deliverooCount : 0;
            
            const keetaAmount = filteredData.reduce((sum, item) => sum + item.keeta, 0);
            const keetaCount = filteredData.reduce((sum, item) => sum + item.countKeeta, 0);
            const keetaAvg = keetaCount > 0 ? keetaAmount / keetaCount : 0;
            
            const totalPlatformAmount = talabatAmount + noonAmount + careemAmount + smileAmount + deliverooAmount + keetaAmount;
            
            const talabatShare = totalPlatformAmount > 0 ? (talabatAmount / totalPlatformAmount * 100).toFixed(1) : 0;
            const noonShare = totalPlatformAmount > 0 ? (noonAmount / totalPlatformAmount * 100).toFixed(1) : 0;
            const careemShare = totalPlatformAmount > 0 ? (careemAmount / totalPlatformAmount * 100).toFixed(1) : 0;
            const smileShare = totalPlatformAmount > 0 ? (smileAmount / totalPlatformAmount * 100).toFixed(1) : 0;
            const deliverooShare = totalPlatformAmount > 0 ? (deliverooAmount / totalPlatformAmount * 100).toFixed(1) : 0;
            const keetaShare = totalPlatformAmount > 0 ? (keetaAmount / totalPlatformAmount * 100).toFixed(1) : 0;
            
            // Update table
            document.getElementById('talabatAmount').textContent = `AED ${talabatAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('talabatCount').textContent = talabatCount.toLocaleString();
            document.getElementById('talabatAvg').textContent = `AED ${talabatAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('talabatShare').textContent = `${talabatShare}%`;
            
            document.getElementById('noonAmount').textContent = `AED ${noonAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('noonCount').textContent = noonCount.toLocaleString();
            document.getElementById('noonAvg').textContent = `AED ${noonAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('noonShare').textContent = `${noonShare}%`;
            
            document.getElementById('careemAmount').textContent = `AED ${careemAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('careemCount').textContent = careemCount.toLocaleString();
            document.getElementById('careemAvg').textContent = `AED ${careemAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('careemShare').textContent = `${careemShare}%`;
            
            document.getElementById('smileAmount').textContent = `AED ${smileAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('smileCount').textContent = smileCount.toLocaleString();
            document.getElementById('smileAvg').textContent = `AED ${smileAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('smileShare').textContent = `${smileShare}%`;
            
            document.getElementById('deliverooAmount').textContent = `AED ${deliverooAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('deliverooCount').textContent = deliverooCount.toLocaleString();
            document.getElementById('deliverooAvg').textContent = `AED ${deliverooAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('deliverooShare').textContent = `${deliverooShare}%`;
            
            document.getElementById('keetaAmount').textContent = `AED ${keetaAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('keetaCount').textContent = keetaCount.toLocaleString();
            document.getElementById('keetaAvg').textContent = `AED ${keetaAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('keetaShare').textContent = `${keetaShare}%`;
            
            // Update chart
            if (charts.platform) {
                charts.platform.destroy();
            }
            
            const ctx3 = document.getElementById('platformChart').getContext('2d');
            charts.platform = new Chart(ctx3, {
                type: 'pie',
                data: {
                    labels: ['Talabat', 'Noon', 'Careem', 'Smile', 'Deliveroo', 'Keeta'],
                    datasets: [{
                        data: [talabatAmount, noonAmount, careemAmount, smileAmount, deliverooAmount, keetaAmount],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateRestaurantPerformance() {
            // Group data by branch
            const branchData = {};
            
            filteredData.forEach(item => {
                if (!branchData[item.branch]) {
                    branchData[item.branch] = {
                        branch: item.branch,
                        internalDelivery: 0,
                        thirdPartyDelivery: 0,
                        totalSales: 0,
                        internalCount: 0,
                        thirdPartyCount: 0
                    };
                }
                
                branchData[item.branch].internalDelivery += item.deliveryCard + item.deliveryCash;
                branchData[item.branch].thirdPartyDelivery += item.talabat + item.keeta + item.noon + item.careem + item.smiles + item.deliveroo;
                branchData[item.branch].totalSales += item.receipts;
                branchData[item.branch].internalCount += item.countDeliveryCard + item.countDeliveryCash;
                branchData[item.branch].thirdPartyCount += item.countTalabat + item.countKeeta + item.countNoon + item.countCareem + item.countSmiles + item.countDeliveroo;
            });
            
            // Convert to array and sort by total delivery
            const branchArray = Object.values(branchData).sort((a, b) => (b.internalDelivery + b.thirdPartyDelivery) - (a.internalDelivery + a.thirdPartyDelivery));
            
            // Update table
            const tableBody = document.getElementById('restaurantTableBody');
            tableBody.innerHTML = '';
            
            branchArray.forEach(branch => {
                const totalDelivery = branch.internalDelivery + branch.thirdPartyDelivery;
                const deliveryPercentage = branch.totalSales > 0 ? (totalDelivery / branch.totalSales * 100).toFixed(1) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${branch.branch}</td>
                    <td>AED ${branch.internalDelivery.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td>AED ${branch.thirdPartyDelivery.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td>AED ${totalDelivery.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td>${deliveryPercentage}%</td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update chart
            if (charts.restaurant) {
                charts.restaurant.destroy();
            }
            
            const ctx = document.getElementById('restaurantChart').getContext('2d');
            charts.restaurant = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: branchArray.map(b => b.branch),
                    datasets: [
                        {
                            label: 'Internal Delivery',
                            data: branchArray.map(b => b.internalDelivery),
                            backgroundColor: 'rgba(75, 192, 192, 0.7)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Third-Party Delivery',
                            data: branchArray.map(b => b.thirdPartyDelivery),
                            backgroundColor: 'rgba(153, 102, 255, 0.7)',
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'AED ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Calculate delivery levels
            const internalAmount = filteredData.reduce((sum, item) => sum + item.deliveryCard + item.deliveryCash, 0);
            const internalCount = filteredData.reduce((sum, item) => sum + item.countDeliveryCard + item.countDeliveryCash, 0);
            const internalAvg = internalCount > 0 ? internalAmount / internalCount : 0;
            
            const thirdPartyAmount = filteredData.reduce((sum, item) => sum + item.talabat + item.keeta + item.noon + item.careem + item.smiles + item.deliveroo, 0);
            const thirdPartyCount = filteredData.reduce((sum, item) => sum + item.countTalabat + item.countKeeta + item.countNoon + item.countCareem + item.countSmiles + item.countDeliveroo, 0);
            const thirdPartyAvg = thirdPartyCount > 0 ? thirdPartyAmount / thirdPartyCount : 0;
            
            const totalDeliveryAmount = internalAmount + thirdPartyAmount;
            const internalPercentage = totalDeliveryAmount > 0 ? (internalAmount / totalDeliveryAmount * 100).toFixed(1) : 0;
            const thirdPartyPercentage = totalDeliveryAmount > 0 ? (thirdPartyAmount / totalDeliveryAmount * 100).toFixed(1) : 0;
            
            // Update table
            document.getElementById('internalAmount').textContent = `AED ${internalAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('internalCount').textContent = internalCount.toLocaleString();
            document.getElementById('internalAvg').textContent = `AED ${internalAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('internalPercentage').textContent = `${internalPercentage}%`;
            
            document.getElementById('thirdPartyAmount').textContent = `AED ${thirdPartyAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('thirdPartyCount').textContent = thirdPartyCount.toLocaleString();
            document.getElementById('thirdPartyAvg').textContent = `AED ${thirdPartyAvg.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('thirdPartyPercentage').textContent = `${thirdPartyPercentage}%`;
            
            // Update chart
            if (charts.deliveryLevels) {
                charts.deliveryLevels.destroy();
            }
            
            const ctx2 = document.getElementById('deliveryLevelsChart').getContext('2d');
            charts.deliveryLevels = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Internal Delivery', 'Third-Party Delivery'],
                    datasets: [{
                        data: [internalAmount, thirdPartyAmount],
                        backgroundColor: ['rgba(75, 192, 192, 0.7)', 'rgba(153, 102, 255, 0.7)'],
                        borderColor: ['rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateMonthlyReport() {
            // Group data by month
            const monthData = {};
            
            filteredData.forEach(item => {
                const monthKey = `${item.year}-${item.month}`;
                
                if (!monthData[monthKey]) {
                    monthData[monthKey] = {
                        year: item.year,
                        month: item.month,
                        totalSales: 0,
                        internalDelivery: 0,
                        thirdPartyDelivery: 0,
                        cashAmount: 0,
                        cardAmount: 0,
                        cashCount: 0,
                        cardCount: 0
                    };
                }
                
                monthData[monthKey].totalSales += item.receipts;
                monthData[monthKey].internalDelivery += item.deliveryCard + item.deliveryCash;
                monthData[monthKey].thirdPartyDelivery += item.talabat + item.keeta + item.noon + item.careem + item.smiles + item.deliveroo;
                monthData[monthKey].cashAmount += item.cash + item.deliveryCash + item.onlineCash;
                monthData[monthKey].cardAmount += item.mastercard + item.visa + item.noon + item.careem + item.smiles + item.deliveroo + item.deliveryCard + item.onlineCard;
                monthData[monthKey].cashCount += item.countCash + item.countDeliveryCash + item.countOnlineCash;
                monthData[monthKey].cardCount += item.countMaster + item.countVisa + item.countNoon + item.countCareem + item.countSmiles + item.countDeliveroo + item.countDeliveryCard + item.countOnlineCard;
            });
            
            // Convert to array and sort by month
            const monthArray = Object.values(monthData).sort((a, b) => {
                if (a.year !== b.year) return a.year - b.year;
                return a.month - b.month;
            });
            
            // Calculate growth
            for (let i = 0; i < monthArray.length; i++) {
                if (i === 0) {
                    monthArray[i].growth = 0;
                } else {
                    const prevSales = monthArray[i - 1].totalSales;
                    const currentSales = monthArray[i].totalSales;
                    monthArray[i].growth = prevSales > 0 ? ((currentSales - prevSales) / prevSales * 100).toFixed(1) : 0;
                }
            }
            
            // Update table
            const tableBody = document.getElementById('monthlyTableBody');
            tableBody.innerHTML = '';
            
            monthArray.forEach(month => {
                const totalAmount = month.cashAmount + month.cardAmount;
                const cashPercentage = totalAmount > 0 ? (month.cashAmount / totalAmount * 100).toFixed(1) : 0;
                const cardPercentage = totalAmount > 0 ? (month.cardAmount / totalAmount * 100).toFixed(1) : 0;
                
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                const monthName = monthNames[month.month - 1];
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${monthName} ${month.year}</td>
                    <td>AED ${month.totalSales.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td>AED ${month.internalDelivery.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td>AED ${month.thirdPartyDelivery.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td>${cashPercentage}%</td>
                    <td>${cardPercentage}%</td>
                    <td>
                        <span class="badge ${month.growth >= 0 ? 'badge-success' : 'badge-danger'}">
                            ${month.growth >= 0 ? '+' : ''}${month.growth}%
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update chart
            if (charts.monthly) {
                charts.monthly.destroy();
            }
            
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            charts.monthly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthArray.map(m => {
                        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        return `${monthNames[m.month - 1]} ${m.year}`;
                    }),
                    datasets: [
                        {
                            label: 'Total Sales',
                            data: monthArray.map(m => m.totalSales),
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Internal Delivery',
                            data: monthArray.map(m => m.internalDelivery),
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Third-Party Delivery',
                            data: monthArray.map(m => m.thirdPartyDelivery),
                            borderColor: 'rgba(153, 102, 255, 1)',
                            backgroundColor: 'rgba(153, 102, 255, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'AED ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = 'notification show';
            
            if (type === 'error') {
                notification.classList.add('error');
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function loadSampleData() {
            // This function loads sample data for demonstration
            // In a real implementation, this would be replaced with actual file processing
            
            // Sample data structure
            const sampleData = [
                // Header row
                ["HEAD", "Branch", "Month", "Year", "Receipts", "TALABAT", "TABNA", "Keeta CARD", "Cash", "NOON CARD", "Master card", "Visa Card", "Careem CARD", "Delivery CARD", "SMILES CARD", "Delivery Cash", "DELIVERO CARD", "ONLINE CASH", "ONLINE CARD", "Count_Receipts", "Count_TALABAT", "Count_TABNA", "Count_Keeta", "Count_Cash", "Count_NOON", "Count_Master", "Count_Visa", "Count_Careem", "Count_DeliveryCard", "Count_SMILES", "Count_DeliveryCash", "Count_DELIVERO", "Count_ONLINE_Cash", "Count_ONLINE_Card"],
                // Sample data rows
                ["0", "Crispy Chicken-Hamdan St", "4", "2025", "713032.85", "54117.2", "0", "0", "186014.7", "76678", "108985.2", "81529.3", "33315.5", "30359.4", "29152", "76265.55", "1355", "22846.6", "12414.4", "23797", "1283", "0", "0", "8824", "2094", "4173", "2780", "774", "614", "726", "1749", "30", "500", "250"],
                ["1", "Crispy Chicken Khaldia", "4", "2025", "568123.4", "66907.5", "0", "0", "141794.5", "70410.55", "96104.2", "75239.4", "24687.85", "15048.5", "14043", "39736.5", "7781", "10359.8", "6010.6", "18743", "1583", "0", "0", "6607", "1909", "3610", "2571", "528", "313", "313", "843", "154", "216", "96"],
                ["2", "Crispy Chicken Shabiya 11", "4", "2025", "638249.55", "58114.3", "0", "0", "170358.6", "91722.25", "113049.5", "76809.3", "27218.7", "17757.8", "29282", "39223.2", "2709", "7009.9", "4995", "20572", "1268", "0", "0", "7450", "2396", "3973", "2571", "698", "361", "695", "885", "30", "148", "97"],
                ["3", "Crispy Chicken Muroor", "4", "2025", "526701.4", "58756.1", "0", "0", "117085.5", "59499.4", "94169.5", "94127", "23090.2", "17654.3", "13822", "39140.9", "3254", "3476.8", "2625.7", "17251", "1332", "0", "0", "5759", "1568", "3301", "3085", "504", "350", "321", "861", "57", "68", "45"],
                ["4", "Crispy Chicken Al Barsha", "4", "2025", "587672.25", "56932.9", "0", "0", "172377.1", "69635.6", "72508.8", "85775.5", "35817.65", "28896.6", "17572", "32525.2", "5984.2", "6923.8", "2722.9", "22717", "1466", "0", "0", "8636", "1861", "3373", "3863", "923", "927", "488", "889", "110", "134", "47"],
                ["5", "Crispy Chicken Al Satwa", "4", "2025", "401399.75", "46661.6", "0", "0", "136611.2", "55635.2", "37767.6", "43045.8", "25925.65", "7002.9", "14256", "22150.9", "834", "9113.9", "2395", "14139", "1189", "0", "0", "6186", "1539", "1451", "1591", "650", "222", "348", "659", "21", "220", "63"],
                ["6", "Crispy Chicken Al Rgga", "4", "2025", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
                ["7", "Crispy Chicken-ELctria", "4", "2025", "725003.9", "85789.3", "0", "0", "285810", "79148.2", "144394.4", "83074.2", "29678.8", "*", "17109", "0", "0", "0", "*", "28496", "2045", "0", "0", "14226", "2248", "5717", "3179", "685", "0", "396", "0", "0", "0", "0"],
                ["8", "Crispy Chicken-Hamdan St", "5", "2025", "779896.16", "78502.01", "0", "0", "179545", "67466", "105428.8", "87058", "76727.95", "42337.4", "29013", "74728.1", "0", "23807.1", "15282.8", "26810", "2006", "0", "0", "8747", "1726", "4089", "3045", "2496", "822", "1281", "1693", "0", "599", "306"],
                ["9", "Crispy Chicken Khaldia", "5", "2025", "636993.45", "101706.3", "0", "0", "133816.2", "55736", "92045.9", "77473.6", "65816.15", "18711.5", "24937", "35898.1", "10534.8", "12771.3", "7546.6", "21403", "2479", "0", "0", "6398", "1401", "3601", "2682", "1989", "351", "1104", "732", "227", "296", "143"],
                ["10", "Crispy Chicken Shabiya 11", "5", "2025", "690026.34", "82371.09", "0", "0", "162737.4", "81939", "103720.7", "74482.8", "66268.15", "24338.4", "45809", "32365", "2950", "9287.8", "3757", "23546", "1992", "0", "0", "7272", "1935", "3805", "2471", "2125", "472", "2416", "715", "35", "229", "79"],
                ["11", "Crispy Chicken Muroor", "5", "2025", "537997.55", "72217.95", "0", "0", "114084.3", "41839", "90524.7", "91953.1", "45571.1", "21529.4", "17892", "32772.5", "3175.6", "4181", "2256.9", "18430", "1768", "0", "0", "5778", "1032", "3236", "3130", "1448", "415", "753", "679", "60", "90", "41"],
                ["12", "Crispy Chicken Al Barsha", "5", "2025", "629874.52", "89097.4", "0", "0", "174601.4", "60410.2", "78601.8", "97187", "51857.82", "15437.7", "25703", "21550.7", "6389", "6702.8", "2335.7", "24979", "2413", "0", "0", "9058", "1505", "3491", "4270", "1783", "377", "1294", "504", "108", "134", "42"],
                ["13", "Crispy Chicken Al Satwa", "5", "2025", "467366.25", "85652.59", "0", "0", "145733.7", "55119", "42165.7", "46452.4", "37542.56", "4925.9", "19178", "15704.8", "1504", "10682.8", "2704.8", "16409", "2333", "0", "0", "6479", "1377", "1615", "1700", "1333", "119", "682", "387", "36", "274", "74"],
                ["14", "Crispy Chicken Al Rgga", "5", "2025", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
                ["15", "Crispy Chicken-ELctria", "5", "2025", "805574.13", "105621.88", "0", "0", "279068.6", "70771", "147053.2", "90210.9", "83505.55", "0", "29343", "0", "0", "0", "*", "31864", "2717", "0", "0", "13999", "1876", "5927", "3466", "2468", "0", "1411", "0", "0", "0", "0"],
                ["16", "Crispy Chicken-Hamdan St", "6", "2025", "802422.7", "70292", "0", "0", "167802.1", "70183", "95082", "80223.5", "132121", "48375.7", "42429.6", "57853.3", "0", "24627.1", "13433.4", "26357", "1488", "0", "0", "7747", "1805", "3574", "2765", "3986", "943", "1874", "1375", "0", "545", "255"],
                ["17", "Crispy Chicken Khaldia", "6", "2025", "673051.75", "110787", "0", "0", "125488.9", "65632", "76390.6", "67505.8", "107789.75", "25847.3", "30508", "31012.6", "12987.4", "13310.4", "5792", "21006", "2258", "0", "0", "5692", "1635", "2830", "2274", "3208", "449", "1330", "629", "324", "268", "109"],
                ["18", "Crispy Chicken Shabiya 11", "6", "2025", "709110.5", "81004", "0", "0", "150376.5", "91791", "84279.3", "65831.4", "97073", "25524.5", "64348", "29086", "4446.8", "11083", "4267", "22937", "1697", "0", "0", "6385", "2177", "3121", "2154", "2869", "490", "3039", "624", "75", "227", "79"],
                ["19", "Crispy Chicken Muroor", "6", "2025", "572960.75", "75584.6", "0", "0", "103700", "47024.35", "78331.1", "83033.2", "95629.3", "24270.7", "23823", "31775", "3189.7", "4295.9", "2303.9", "18287", "1560", "0", "0", "4979", "1165", "2733", "2748", "2864", "455", "980", "621", "62", "91", "29"],
                ["20", "Crispy Chicken Al Barsha", "6", "2025", "664193.64", "82159", "0", "0", "165442", "74702.92", "69533.7", "89733.8", "91895.22", "19546.5", "36868", "21889.7", "4546", "5947.8", "1929", "24731", "1869", "0", "0", "8348", "1889", "3080", "3981", "2660", "439", "1765", "452", "87", "123", "38"],
                ["21", "Crispy Chicken Al Satwa", "6", "2025", "509383.02", "78146", "0", "0", "145487", "68818", "38024.2", "46191.6", "71963.92", "6534.8", "24912", "14469.8", "1021", "10674.7", "3140", "16685", "1759", "0", "0", "6172", "1774", "1389", "1669", "2098", "154", "997", "309", "21", "268", "75"],
                ["22", "Crispy Chicken Al Rgga", "6", "2025", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
                ["23", "Crispy Chicken-ELctria", "6", "2025", "835561.1", "77934.6", "0", "0", "276154.5", "81448", "128717.8", "81216.7", "149330.5", "*", "40759", "*", "*", "*", "*", "31156", "1685", "0", "0", "12991", "2142", "4959", "3003", "4565", "0", "1811", "0", "0", "0", "0"],
                ["24", "Crispy Chicken-Hamdan St", "7", "2025", "777059.15", "66926.1", "0", "0", "172422.2", "89252", "99073.6", "79656", "92367.75", "51512.1", "26574", "57693.2", "0", "26364.7", "15217.5", "26169", "1591", "0", "0", "8455", "2336", "4052", "2900", "2370", "1151", "901", "1406", "0", "682", "325"],
                ["25", "Crispy Chicken Khaldia", "7", "2025", "694472.4", "117570", "0", "0", "127529.4", "119262", "77361.8", "65523.2", "80288.5", "24510.4", "19850", "27107.4", "17703.5", "11913.3", "5852.9", "22152", "2681", "0", "0", "6279", "3033", "3060", "2411", "2025", "501", "675", "596", "465", "297", "129"],
                ["26", "Crispy Chicken Shabiya 11", "7", "2025", "741667.75", "69781.6", "0", "0", "152950.1", "182336", "93975.1", "65937.6", "66697.75", "23603", "35455", "31556.8", "2465", "12398.9", "4510.9", "23241", "1578", "0", "0", "6871", "4241", "3565", "2355", "1699", "517", "1321", "660", "30", "312", "92"],
                ["27", "Crispy Chicken Muroor", "7", "2025", "564894", "65616.5", "0", "0", "104652", "84981", "80619.4", "85486", "63691.5", "26768.4", "17051", "26232.9", "3668.7", "4192.8", "1933.8", "18295", "1521", "0", "0", "5239", "2149", "2930", "2887", "1653", "550", "594", "564", "83", "95", "30"],
                ["28", "Crispy Chicken Al Barsha", "7", "2025", "618161.7", "54250", "0", "0", "160480", "108752", "67285.8", "93884.1", "47575", "23714.9", "27647", "20911.8", "5208.2", "5862", "2590.9", "23642", "1303", "0", "0", "8525", "2735", "3131", "4265", "1288", "521", "1091", "486", "124", "124", "49"],
                ["29", "Crispy Chicken Al Satwa", "7", "2025", "522713.7", "53308", "0", "0", "152499.2", "112494", "42893.4", "56615.5", "39813", "8327", "20813", "16357.8", "1510", "13780.9", "4301.9", "17692", "1275", "0", "0", "6968", "2870", "1619", "2027", "1101", "184", "794", "344", "26", "376", "108"],
                ["30", "Crispy Chicken Al Rgga", "7", "2025", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
                ["31", "Crispy Chicken-ELctria", "7", "2025", "857462.9", "106325.7", "0", "*", "270913.8", "141613", "123620.7", "85049.2", "104304.5", "0", "25636", "0", "0", "*", "*", "31963", "2537", "0", "0", "13510", "3788", "5195", "3357", "2692", "0", "884", "0", "0", "0", "0"],
                ["32", "Crispy Chicken-Hamdan St", "8", "2025", "755184.5", "34146", "0", "0", "153603.6", "82445", "90102.7", "72028", "169359.1", "55024.6", "15481", "48159.5", "0", "23005.4", "11829.6", "25560", "773", "0", "0", "7589", "2245", "3613", "2556", "5174", "1139", "592", "1108", "0", "551", "220"],
                ["33", "Crispy Chicken Khaldia", "8", "2025", "637005.25", "85718", "0", "0", "105227.4", "84210", "70391.9", "61783.4", "138502.75", "27759.7", "10877", "23279.7", "11894", "11873.5", "5487.9", "20366", "1868", "0", "0", "5043", "2209", "2721", "2215", "4171", "511", "407", "521", "335", "252", "113"],
                ["34", "Crispy Chicken Shabiya 11", "8", "2025", "694108.25", "49748", "0", "0", "142059.3", "120861.5", "86039.4", "65922.9", "138677.75", "30474.8", "21513", "24860.8", "1383", "9286.8", "3281", "22402", "1069", "0", "0", "6426", "2894", "3211", "2342", "4088", "606", "929", "556", "21", "190", "70"],
                ["35", "Crispy Chicken Muroor", "8", "2025", "516549.3", "47553", "0", "0", "97705.7", "62998", "72921.3", "80103.3", "94395.9", "23238.6", "8410", "21122.8", "2217", "3829.8", "2053.9", "16968", "1015", "0", "0", "4790", "1625", "2651", "2710", "2813", "492", "297", "420", "39", "80", "36"],
                ["36", "Crispy Chicken Al Barsha", "8", "2025", "648693.85", "52223", "0", "0", "156793.3", "88138.5", "67635.7", "89040.8", "118072.25", "24315.8", "12843", "24979.9", "7248", "4830.9", "2572.7", "23814", "1208", "0", "0", "7983", "2267", "2987", "3984", "3639", "498", "531", "403", "155", "109", "50"],
                ["37", "Crispy Chicken Al Satwa", "8", "2025", "532036.55", "47974", "0", "0", "140287.4", "99441", "40173.8", "50752.5", "105013.25", "8769.9", "9176", "13705.9", "1840", "11337.8", "3565", "17853", "1155", "0", "0", "6294", "2562", "1490", "1845", "3254", "178", "322", "314", "52", "287", "100"],
                ["38", "Crispy Chicken Al Rgga", "8", "2025", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
                ["39", "Crispy Chicken-ELctria", "8", "2025", "805213.3", "71230", "0", "0", "248702.3", "100728.5", "117440.6", "81469.4", "174850.5", "0", "10792", "0", "0", "0", "0", "30581", "1706", "0", "0", "12414", "2751", "4762", "3138", "5390", "0", "420", "0", "0", "0", "0"],
                ["40", "Crispy Chicken-Hamdan St", "9", "2025", "722126.83", "0", "0", "0", "156497.9", "121182.74", "90563.8", "73915.8", "96353.49", "58980.8", "35906", "47580.7", "0", "25945.1", "15200.5", "24619", "0", "0", "0", "7519", "3553", "3600", "2753", "2674", "1234", "1286", "1111", "0", "602", "287"],
                ["41", "Crispy Chicken Khaldia", "9", "2025", "571512.2", "0", "0", "0", "114135", "118512.13", "73708.8", "62959", "81100.77", "29906.7", "27564", "27862.7", "19268.5", "9426.7", "7067.9", "19137", "0", "0", "0", "5554", "3300", "2890", "2280", "2218", "581", "949", "563", "486", "194", "122"],
                ["42", "Crispy Chicken Shabiya 11", "9", "2025", "669003.3", "0", "0", "0", "137532.9", "171659.46", "86172.8", "67246.8", "80976.74", "33670.8", "52701", "27618.8", "1004", "6870", "3550", "21870", "0", "0", "0", "6169", "4558", "3150", "2314", "2267", "656", "1914", "613", "13", "157", "59"],
                ["43", "Crispy Chicken Muroor", "9", "2025", "493890.77", "0", "0", "0", "107632.8", "89313.16", "78434.9", "77196.8", "57361.41", "25414.4", "21535", "25603.9", "4730.6", "4368", "2299.8", "16509", "0", "0", "0", "5077", "2468", "2844", "2671", "1568", "516", "707", "457", "82", "87", "32"],
                ["44", "Crispy Chicken Al Barsha", "9", "2025", "629719.75", "0", "0", "15675", "158980.9", "143838.04", "64293", "87489.9", "74319.51", "22251", "25437.7", "21109.8", "7835", "5655.9", "2834", "23756", "0", "0", "209", "7945", "3922", "2859", "3898", "2027", "464", "1703", "415", "147", "107", "60"],
                ["45", "Crispy Chicken Al Satwa", "9", "2025", "557244.49", "0", "0", "16425.1", "146964", "163809.88", "40364.9", "52771", "63710.41", "8561", "33051.6", "14505", "1849.6", "11576", "3656", "19546", "0", "0", "235", "6658", "4648", "1565", "1957", "1783", "189", "1781", "306", "48", "285", "91"],
                ["46", "Crispy Chicken Al Rgga", "9", "2025", "0", "0", "0", "4506.2", "31690.4", "957", "14338.5", "20902.1", "559", "317", "1252", "1676", "0", "0", "0", "3680", "0", "0", "77", "1789", "24", "701", "960", "12", "5", "72", "40", "0", "0", "0"],
                ["47", "Crispy Chicken-ELctria", "9", "2025", "76198.2", "0", "0", "0", "249546", "139599.1", "122085", "85520.8", "99607.43", "0", "31228.6", "0", "0", "0", "0", "28364", "0", "0", "0", "12162", "4064", "4951", "3296", "2824", "0", "1067", "0", "0", "0", "0"],
                ["48", "Crispy Chicken-Hamdan St", "10", "2025", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],
                ["49", "Crispy Chicken Khaldia", "10", "2025", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],
                ["50", "Crispy Chicken Shabiya 11", "10", "2025", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],
                ["51", "Crispy Chicken Muroor", "10", "2025", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],
                ["52", "Crispy Chicken Al Barsha", "10", "2025", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],
                ["53", "Crispy Chicken Al Satwa", "10", "2025", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],
                ["54", "Crispy Chicken Al Rgga", "10", "2025", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"],
                ["55", "Crispy Chicken-ELctria", "10", "2025", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*", "*"]
            ];
            
            // Process the sample data
            processData(sampleData);
        }
    </script>
</body>
</html>
